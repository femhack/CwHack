package net.cwhack.features;

import net.cwhack.events.PacketInputListener;
import net.cwhack.feature.Feature;
import net.cwhack.setting.DecimalSetting;
import net.cwhack.utils.ChatUtils;
import net.minecraft.entity.player.PlayerEntity;
import net.minecraft.network.packet.s2c.play.EntityPositionS2CPacket;
import net.minecraft.util.math.Vec3d;

import static net.cwhack.CwHack.MC;

public class StasisExploitFeature extends Feature implements PacketInputListener
{

	private final DecimalSetting distance = new DecimalSetting("distance", "the distance that will trigger it", 128.0, this);

	public StasisExploitFeature()
	{
		super("StasisExploit", "print any player's coords when they teleport really far away using pearls");
		addSetting(distance);
	}

	@Override
	protected void onEnable()
	{
		eventManager.add(PacketInputListener.class, this);
	}

	@Override
	protected void onDisable()
	{
		eventManager.remove(PacketInputListener.class, this);
	}

	@Override
	public void onReceivePacket(PacketInputEvent event)
	{
		if (event.getPacket() instanceof EntityPositionS2CPacket packet)
		{
			if (MC.world.getEntityById(packet.getId()) instanceof PlayerEntity player)
			{
				Vec3d newPos = new Vec3d(packet.getX(), packet.getY(), packet.getZ());
				double tpDistanceSq = player.squaredDistanceTo(newPos);
				double distanceSq = distance.getValue() * distance.getValue();
				if (tpDistanceSq >= distanceSq)
					ChatUtils.info("Player " + player.getEntityName() + " TP-ed: "
							+ newPos.x + " "
							+ newPos.y + " "
							+ newPos.z);
			}
		}
	}
}
